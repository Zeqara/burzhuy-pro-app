<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Тайный агент BURЖУЙ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>

    <div id="app-container">
        
        <div id="loader" class="screen active"><div class="spinner"></div></div>

        <!-- НОВЫЙ ЭКРАН АВТОРИЗАЦИИ -->
        <div id="auth-screen" class="screen">
            <div class="auth-container">
                <!-- Шаг 1: Ввод номера телефона -->
                <div id="phone-view">
                    <h2>Вход или Регистрация</h2>
                    <p class="auth-toggle" style="margin-bottom: 20px; color: var(--text-secondary);">Введите ваш номер телефона для входа или создания нового аккаунта.</p>
                    <form id="phone-form">
                        <div class="form-group">
                            <input type="tel" id="phone-input" placeholder="+7 (999) 999-99-99" required>
                        </div>
                        <button type="submit" id="send-code-btn" class="btn-primary">Получить код</button>
                    </form>
                </div>
                <!-- Шаг 2: Ввод СМС-кода -->
                <div id="code-view" style="display: none;">
                    <h2>Подтверждение</h2>
                    <p class="auth-toggle" style="margin-bottom: 20px; color: var(--text-secondary);">Мы отправили СМС-код на ваш номер. Введите его ниже.</p>
                    <form id="code-form">
                        <div class="form-group">
                            <input type="text" id="code-input" placeholder="Код из СМС" required>
                        </div>
                        <button type="submit" class="btn-primary">Войти</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- ЭКРАН ЗАПОЛНЕНИЯ ПРОФИЛЯ ДЛЯ НОВЫХ ПОЛЬЗОВАТЕЛЕЙ -->
        <div id="profile-setup-screen" class="screen">
            <div class="auth-container">
                <h2>Завершение регистрации</h2>
                <p class="auth-toggle" style="margin-bottom: 20px; color: var(--text-secondary);">Пожалуйста, укажите ваше имя и фамилию.</p>
                <form id="profile-setup-form">
                    <div class="form-group">
                        <label>Имя и Фамилия</label>
                        <input type="text" id="profile-name-input" placeholder="Иван Иванов" required>
                    </div>
                    <button type="submit" class="btn-primary">Сохранить и войти</button>
                </form>
            </div>
        </div>
        
        <!-- Дашборд и остальные экраны (остаются прежними) -->
        <div id="main-menu-screen" class="screen">
             <div class="dashboard-header">
                <div class="avatar">Б</div>
                <h2 id="user-name-display">BURЖУЙ</h2>
                <p>Тайный агент</p>
            </div>
            <div class="content">
                <ul class="menu-list">
                    <li class="menu-list-item menu-btn" data-target="cooperation-screen">
                        <i class="icon fa-solid fa-handshake"></i>
                        <div><strong>Начать сотрудничество</strong><small>Выбрать точку для проверки</small></div>
                    </li>
                    <li class="menu-list-item menu-btn" data-target="history-screen">
                        <i class="icon fa-solid fa-list-check"></i>
                        <div><strong>История проверок</strong><small>Посмотреть статусы отчетов</small></div>
                    </li>
                    <li class="menu-list-item menu-btn" data-target="instruction-screen">
                        <i class="icon fa-solid fa-book-open"></i>
                        <div><strong>Инструкция</strong><small>Правила и требования</small></div>
                    </li>
                </ul>
                <div id="admin-menu-container" style="margin-top: 15px;"></div>
                <button id="logout-btn">Выйти из аккаунта</button>
            </div>
        </div>
        
        <!-- Остальные экраны остаются без изменений в структуре -->
        <div id="cooperation-screen" class="screen"><header><button class="back-btn" data-target="main-menu-screen"><i class="fa-solid fa-chevron-left"></i> Назад</button></header><div class="content"><div id="city-list" class="menu-list"></div></div></div>
        <div id="history-screen" class="screen"><header><button class="back-btn" data-target="main-menu-screen"><i class="fa-solid fa-chevron-left"></i> Назад</button><h2>История проверок</h2></header><div class="content scrollable"><ul id="history-list" class="locations-list"></ul></div></div>
        <div id="instruction-screen" class="screen"><header><button class="back-btn" data-target="main-menu-screen"><i class="fa-solid fa-chevron-left"></i> Назад</button><h2>Инструкция</h2></header><div class="content scrollable"><p>Здесь будет текст инструкции...</p></div></div>
        <div id="admin-screen" class="screen"><header><button class="back-btn" data-target="main-menu-screen"><i class="fa-solid fa-chevron-left"></i> Назад</button><h2>Все отчеты</h2></header><div class="content scrollable"><ul id="admin-reports-list" class="locations-list"></ul></div></div>
        <!-- и так далее для всех остальных экранов... -->
    </div>
    
    <!-- Невидимый элемент для reCAPTCHA от Firebase. Он должен быть в HTML. -->
    <div id="recaptcha-container"></div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    <script src="app.js"></script>
</body>
</html>
